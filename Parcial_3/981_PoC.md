# üìù Reporte de Actividad #981 - Prueba de Concepto (PoC)  
## Simulaci√≥n de un Ataque de Inyecci√≥n SQL y Mitigaci√≥n usando un WAF (ModSecurity)

### Kenny Yaritza Benitez Renteral | 210300510
14/05/2025

El objetivo de esta prueba de concepto es simular un ataque de inyecci√≥n SQL en una aplicaci√≥n web vulnerable y demostrar c√≥mo un Web Application Firewall, en este caso ModSecurity, puede mitigar este tipo de ataque.  
Este es un tema altamente relevante en seguridad de datos, ya que la inyecci√≥n SQL est√° entre las vulnerabilidades m√°s cr√≠ticas y comunes del OWASP Top Ten.

Para ello decidi utilizar:
* Docker para realizar los contenedores de Juice Shop, Nginx, ModSecurity.
* OWASP Juice Shop, lo utilice como aplicaci√≥n vulnerable para simular el ataque.
* ModSecurity, para que sea la  Web Application Firewall (WAF) para mitigar el ataque.
* Postman, sera la herramienta para realizar pruebas de inyecci√≥n SQL.

## Pasos:
### 1. Configuraci√≥n del entorno

Se levant√≥ el contenedor vulnerable Juice Shop con el siguiente comando:

```bash
docker run --name juice-shop -d -p 3000:3000 bkimminich/juice-shop
```
para despues acceder desde el navegador por medio de :
**[http://localhost:3000/#/](http://localhost:3000/#/)**

Despues cree una imagen personalizada de Nginx con ModSecurity usando Docker.

```Dockerfile
FROM nginx:latest
RUN apt-get update && apt-get install -y libmodsecurity3 libmodsecurity-dev
COPY modsecurity.conf /etc/modsecurity/modsecurity.conf
COPY nginx.conf /etc/nginx/nginx.conf
```

lo trate de ejecutar por medio de:

```bash
docker build -t nginx-modsec-custom .
docker run --name modsec --restart=no -d -p 8080:80 nginx-modsec-custom
```

En teor√≠a deberia de poder ingresar por medio de : **[http://localhost:8080](http://localhost:8080)** 
Asi como verse la ventana de Juice Shop protegida por Nginx + ModSecurity.

Sin embargo, en este paso al inicio el navegador mostraba que Nginx se estaba ejecutando correctamente pero que hac√≠a falta configuraci√≥n adicional para servir Juice Shop.

### Correcciones:

* Se intent√≥ modificar los archivos `nginx.conf` y `modsecurity.conf`.
* Se eliminaron y recrearon los contenedores repetidas veces.
* Se ajustaron puertos y vol√∫menes.

Apesar de todo, ahora el contenedor de Nginx se enciende y se apaga inmediatamente.
Seg√∫n los mensajes de error en logs es debido a que el modulo no esta presente o no fue cargado correctamente.

### 4. Estado actual

* `http://localhost:3000/#/` ‚Üí Funciona correctamente (Juice Shop directo).
* `http://localhost:8080/` ‚Üí **No responde**, el contenedor se apaga.


## Simulaci√≥n del ataque

 Inyecci√≥n SQL en campos de inicio de sesi√≥n
Payload utilizado:`' OR 1=1--`
 A trav√©s del puerto 3000 (sin protecci√≥n), fue posible simular el ataque con √©xito y acceder sin credenciales v√°lidas.

La intenci√≥n era redirigir ese tr√°fico a trav√©s de Nginx con ModSecurity para detectar y mitigar el payload, pero no fue posible probarlo debido a los errores mencionados.


## Conclusiones

* La PoC permiti√≥ confirmar que **Juice Shop es vulnerable** a ataques de inyecci√≥n SQL.
* Se evidenci√≥ la **importancia de un WAF como ModSecurity**, aunque su implementaci√≥n presenta desaf√≠os t√©cnicos.
* El principal obst√°culo fue que **la imagen personalizada de Nginx no carg√≥ correctamente el m√≥dulo de ModSecurity**.
* Se recomienda:

  * Probar con una imagen base diferente (`owasp/modsecurity-crs:nginx` o similares).
  * Verificar rutas y dependencias durante el `docker build`.
  * Usar `docker-compose` para integrar todos los servicios.


